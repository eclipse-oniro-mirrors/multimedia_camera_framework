From a085ac071b6a9fb6c6ffcfcff7b5009fdc32e373 Mon Sep 17 00:00:00 2001
From: f00373274 <f00373274@notesmail.huawei.com/>
Date: Mon, 6 May 2024 12:26:17 +0800
Subject: [PATCH] TicketNo:DTS2024042918315 Description:secure camera test
 Team:EMUI Feature or Bugfix:Bugfix Binary Source:No PrivateCode(Yes/No):No
 Change-Id: Icce42b05da792dcf0d45a0d77c5e574cef8b3996

---
 .../js/camera_napi/src/input/camera_manager_napi.cpp   | 10 +++++++---
 .../js/camera_napi/src/mode/mode_manager_napi.cpp      |  3 +++
 .../js/camera_napi/include/mode/mode_manager_napi.h    |  1 +
 3 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/frameworks/js/camera_napi/src/input/camera_manager_napi.cpp b/frameworks/js/camera_napi/src/input/camera_manager_napi.cpp
index 6a357be7..55549f75 100644
--- a/frameworks/js/camera_napi/src/input/camera_manager_napi.cpp
+++ b/frameworks/js/camera_napi/src/input/camera_manager_napi.cpp
@@ -58,12 +58,14 @@ const std::unordered_map<SceneMode, JsSceneMode> g_nativeToNapiSupportedModeForS
     {SceneMode::SLOW_MOTION,  JsSceneMode::JS_SLOW_MOTION},
     {SceneMode::PROFESSIONAL_PHOTO,  JsSceneMode::JS_PROFESSIONAL_PHOTO},
     {SceneMode::PROFESSIONAL_VIDEO,  JsSceneMode::JS_PROFESSIONAL_VIDEO},
-    {SceneMode::HIGH_RES_PHOTO, JsSceneMode::JS_HIGH_RES_PHOTO}
+    {SceneMode::HIGH_RES_PHOTO, JsSceneMode::JS_HIGH_RES_PHOTO},
+    {SceneMode::SECURE, JsSceneMode::JS_SECURE_CAMERA},
 };
 
 const std::unordered_map<SceneMode, JsSceneMode> g_nativeToNapiSupportedMode_ = {
     {SceneMode::CAPTURE,  JsSceneMode::JS_CAPTURE},
-    {SceneMode::VIDEO,  JsSceneMode::JS_VIDEO}
+    {SceneMode::VIDEO,  JsSceneMode::JS_VIDEO},
+    {SceneMode::SECURE,  JsSceneMode::JS_SECURE_CAMERA},
 };
 
 CameraManagerCallbackNapi::CameraManagerCallbackNapi(napi_env env): ListenerBase(env)
@@ -304,7 +306,8 @@ const std::unordered_map<JsSceneMode, SceneMode> g_jsToFwMode_ = {
     {JsSceneMode::JS_VIDEO_MARCO, SceneMode::VIDEO_MACRO},
     {JsSceneMode::JS_PROFESSIONAL_PHOTO, SceneMode::PROFESSIONAL_PHOTO},
     {JsSceneMode::JS_PROFESSIONAL_VIDEO, SceneMode::PROFESSIONAL_VIDEO},
-    {JsSceneMode::JS_HIGH_RES_PHOTO, SceneMode::HIGH_RES_PHOTO}
+    {JsSceneMode::JS_HIGH_RES_PHOTO, SceneMode::HIGH_RES_PHOTO},
+    {JsSceneMode::JS_SECURE_CAMERA, SceneMode::SECURE},
 };
 
 CameraManagerNapi::CameraManagerNapi() : env_(nullptr), wrapper_(nullptr)
@@ -569,6 +572,7 @@ napi_value CameraManagerNapi::CreateSessionInstance(napi_env env, napi_callback_
             break;
         case JsSceneMode::JS_PROFESSIONAL_VIDEO:
             result = ProfessionSessionNapi::CreateCameraSession(env, SceneMode::PROFESSIONAL_VIDEO);
+            break;
         case JsSceneMode::JS_SECURE_CAMERA:
             result = SecureCameraSessionNapi::CreateCameraSession(env);
             break;
diff --git a/frameworks/js/camera_napi/src/mode/mode_manager_napi.cpp b/frameworks/js/camera_napi/src/mode/mode_manager_napi.cpp
index 424eba70..4725ab64 100644
--- a/frameworks/js/camera_napi/src/mode/mode_manager_napi.cpp
+++ b/frameworks/js/camera_napi/src/mode/mode_manager_napi.cpp
@@ -164,6 +164,9 @@ napi_value ModeManagerNapi::CreateCameraSessionInstance(napi_env env, napi_callb
         case JS_NIGHT:
             result = NightSessionNapi::CreateCameraSession(env);
             break;
+        case JS_SECURE_CAMERA:
+            result = SecureCameraSessionNapi::CreateCameraSession(env);
+            break;
         default:
             MEDIA_ERR_LOG("ModeManagerNapi::CreateCameraSessionInstance mode = %{public}d not supported", jsModeName);
             break;
diff --git a/interfaces/kits/js/camera_napi/include/mode/mode_manager_napi.h b/interfaces/kits/js/camera_napi/include/mode/mode_manager_napi.h
index a31c8989..37de5803 100644
--- a/interfaces/kits/js/camera_napi/include/mode/mode_manager_napi.h
+++ b/interfaces/kits/js/camera_napi/include/mode/mode_manager_napi.h
@@ -32,6 +32,7 @@
 #include "photo_session_napi.h"
 #include "night_session_napi.h"
 #include "video_session_napi.h"
+#include "secure_camera_session_napi.h"
 #include "session/camera_session_napi.h"
 #include "camera_napi_utils.h"
 
-- 
2.40.1.huawei.3

